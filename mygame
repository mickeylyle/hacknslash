#!/usr/bin/python

import pygame
import sys

#defaults, all of this gets set in setup_screen
SCREEN_WIDTH = 1020
SCREEN_HEIGHT = 720
PIXEL_HEIGHT = 240
PIXEL_RATIO = 1
ISCREEN_WIDTH = 320
ISCREEN_HEIGHT = 240
SCREEN_X_OFFSET = 0
SCREEN_Y_OFFSET = 0

def setup_screen(width, height):
    global SCREEN_WIDTH
    global SCREEN_HEIGHT
    global PIXEL_RATIO
    global ISCREEN_HEIGHT
    global ISCREEN_WIDTH
    global SCREEN_X_OFFSET
    global SCREEN_Y_OFFSET
    SCREEN_WIDTH = width
    SCREEN_HEIGHT = height
    PIXEL_RATIO = height / PIXEL_HEIGHT
    ISCREEN_HEIGHT = PIXEL_HEIGHT + ((height % PIXEL_HEIGHT) / PIXEL_RATIO)
    ISCREEN_WIDTH = width / PIXEL_RATIO
    SCREEN_X_OFFSET = (SCREEN_WIDTH - (ISCREEN_WIDTH * PIXEL_RATIO)) / 2
    SCREEN_Y_OFFSET = (SCREEN_HEIGHT - (ISCREEN_HEIGHT * PIXEL_RATIO)) / 2
    return pygame.display.set_mode([width, height], pygame.SRCALPHA, 32), \
        pygame.Surface([ISCREEN_WIDTH, ISCREEN_HEIGHT], pygame.SRCALPHA, 32)

def flip_display(iscreen, screen):
    screen.blit(pygame.transform.scale(iscreen, \
        [ISCREEN_WIDTH * PIXEL_RATIO, ISCREEN_HEIGHT * PIXEL_RATIO]), \
        [SCREEN_X_OFFSET, SCREEN_Y_OFFSET])
    pygame.display.flip()

def draw_map():
    tile_width = 32
    tile_height = 16
    map_dimension = 10
    map_surface = pygame.Surface([map_dimension * tile_width, \
        map_dimension * tile_height], pygame.SRCALPHA, 32)
    tile_nw = pygame.image.load('images/tiles/dirt_nw.png').convert_alpha()
    tile_ne = pygame.image.load('images/tiles/dirt_ne.png').convert_alpha()
    tile_sw = pygame.image.load('images/tiles/dirt_sw.png').convert_alpha()
    tile_se = pygame.image.load('images/tiles/dirt_se.png').convert_alpha()
    for i in range(0, map_dimension):
        for j in range (0, map_dimension):
            x = ((map_dimension -1 - j) * tile_width / 2) + (i * tile_width / 2)
            y = (i * tile_height / 2) - ((map_dimension - 1 - j) * tile_height / 2) + \
                (map_dimension * tile_height / 2 - tile_height / 2)
            map_surface.blit(tile_nw, [x, y])
            map_surface.blit(tile_ne, [x + tile_width / 2, y])
            map_surface.blit(tile_sw, [x, y + tile_height / 2])
            map_surface.blit(tile_se, [x + tile_width / 2, y + tile_height / 2])
    return map_surface

def main():
    quit = False
    pygame.init()
    screen, iscreen = setup_screen(SCREEN_WIDTH, SCREEN_HEIGHT)
    clock = pygame.time.Clock()
    tile = pygame.image.load('images/tiles/grass.png').convert_alpha()

    while not quit:
        time_passed = clock.tick(50)
        for event in pygame.event.get():
            if event.type == pygame.QUIT: quit = True
            elif event.type == pygame.KEYDOWN:
                if event.key == pygame.K_q: pygame.event.post(pygame.event.Event(pygame.QUIT))
        y = 0
        while y <= ISCREEN_HEIGHT / 10:
           x = 0
           while x <= ISCREEN_WIDTH / 10:
               iscreen.blit(tile, [x * 10, y * 10])
               x += 1
           y += 1

        iscreen.blit(draw_map(), [0, 0])
        flip_display(iscreen, screen)

    sys.exit()

main()
